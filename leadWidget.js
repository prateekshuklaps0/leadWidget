class LeadWidget{constructor(e){const t=document.createElement("link");t.rel="stylesheet",t.href="leadWidget.css",document.head.appendChild(t);const i=JSON.parse(window.atob(e));console.log("parsedData",i);for(let e in i)this[e]=i[e];this.iFrameDiv=document.querySelector(`.frame-${this.widgetData?.uuid}`),this.iframeInit()}fieldInpVals={};createElement=(e,t={},i={})=>{const a=document.createElement(e);Object.assign(a.style,t);for(const e in i)a.setAttribute(e,i[e]);return a};showError=(e,t)=>{e.classList.add("visible"),e.textContent=t};createLabel=({text:e,styles:t={},...i})=>{const a=this.createElement("label",t,{...i});return a.textContent=e,a};createButton=({text:e,styles:t={},onClick:i,...a})=>{const n=this.createElement("button",t,{...a});return n.textContent=e,n.onclick=i,n};createParagraph=(e,t={},i={})=>{const a=this.createElement("p",t);a.textContent=e;for(const e in i)a.setAttribute(e,i[e]);return a};getFieldType=e=>{switch(e){case"telephone":case"phone":return"number";case"calendar":return"date";case"textbox":return"text";case"dropdown":return"select";case"fileUpload":return"file";default:return e}};createRadioInp=e=>{const t=this.createElement("div",{},{class:"radio-cont-div"});return t.innerHTML=e?.options?.map((t=>`<input type="radio" name="${e?.uuid}" value="${t?.uuid}" id="" class="radio-opts"><p>${t?.label}</p>`)).join(""),t.onchange=e=>{const{name:t,value:i}=e.target;this.fieldInpVals={...this.fieldInpVals,[t]:i}},t};createCheckboxInp=e=>{const t=this.createElement("div",{},{class:"radio-cont-div"});return t.innerHTML=e?.options?.map((t=>`<input type="checkbox" name="${e?.uuid}" value="${t?.uuid}" id="" class="checkbox-opts"><p>${t?.label}</p>`)).join(""),t.onchange=e=>{const{name:t,value:i,checked:a}=e.target;this.fieldInpVals={...this.fieldInpVals,[t]:a?[...this.fieldInpVals[t]||[],i]:[...(this.fieldInpVals[t]||[]).filter((e=>e!=i))]}},t};createSelectInp=e=>{const t=this.createElement("select",{},{name:e?.uuid||"",placeholder:e?.placeholder||"Select Option",required:e?.isRequired||!1});return t.innerHTML=`<option value="">${e?.placeholder||"Select Option"}</option>\n${e?.options?.map((e=>`<option value="${e?.uuid}">${e?.label}</option>`)).join("")}`,t.onchange=e=>{const{name:t,value:i}=e.target;this.fieldInpVals={...this.fieldInpVals,[t]:i}},t};createInput(e,t){const i="textarea"==t,a=this.createElement(i?"textarea":"input",{},{type:t,name:e?.uuid||"",placeholder:e?.placeholder||"",required:e?.isRequired||!1});return a.onchange=e=>{const{name:t,value:i}=e.target;this.fieldInpVals={...this.fieldInpVals,[t]:i}},a}createFileInp=e=>{const t=this.createElement("input",{},{type:"file",name:e?.uuid||"",placeholder:e?.placeholder||"",required:e?.isRequired||!1});return t.onchange=e=>{const{name:t,value:i}=e.target;this.fieldInpVals={...this.fieldInpVals,[t]:{fileName:i,value:i}}},t};renderFields(){const e=this.createElement("div",{},{class:"fields-Cont"});return Array.isArray(this.fieldsData)?(this.fieldsData.forEach(((t,i)=>{const a=this.createElement("div",{},{class:"field-item-div"}),n=this.createLabel({text:t?.label||""});let s;const l=this.getFieldType(t?.type);"radio"==l?s=this.createRadioInp(t):"checkbox"==l?s=this.createCheckboxInp(t):"select"==l?s=this.createSelectInp(t):"file"==l?s=this.createFileInp(t):["textarea","text","number","email","date"].includes(l)?s=this.createInput(t,l):"otp"==l?s=this.createInput(t,"number"):(console.log("field",t),s=this.createInput(t,l)),a.append(n,s),e.appendChild(a)})),e):console.error("`this.fieldsData` is not an array or is :",this.fieldsData)}async iframeInit(){const e=this.renderFields(),t=this.createButton({text:"Submit",type:"submit",class:"iframeBtn"});t.addEventListener("click",(async()=>{this.fieldsData?.map((e=>{let t={fieldUuid:e?.uuid};const i=this.getFieldType(e?.type);return["select","radio"].includes(i)?t.selectedOptions=e?.options?.filter((t=>t.uuid==this.fieldInpVals[e?.uuid])):"file"==i?t.value=this.fieldInpVals[e?.uuid]||{}:"checkbox"==i?t.selectedOptions=(this.fieldInpVals[e?.uuid]||[]).map((t=>e?.options?.find((e=>e?.uuid==t)))):t.value=(this.fieldInpVals[e?.uuid]||"").trim(),t})),this.theme,this.formData,this.programData,this.thankYouPageData,this.widgetData;t.innerHTML="Loading";try{const e=await fetch("http://localhost:2024/api/widgets/allWidgetDetails",{method:"GET",headers:{"Content-Type":"application/json",authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTMsIm9yZ2FuaXphdGlvbklkIjoyNywic3R1ZGVudElkIjoiNDBmMzM1MTMtZTBiMC00MjFlLWEzNDItOTM4ZmE2NWEzNjFlIiwibmFtZSI6IkFkYXJzaCBDaGFrcmFib3J0eSIsImVtYWlsIjoiYWRhcnNoY2hhazEwOEBnbWFpbC5jb20iLCJ1c2VyTW9iaWxlTnVtYmVyIjo5OTI3OTY4NDUxLCJpc0FkbWluIjp0cnVlLCJpYXQiOjE3MzQxNTU5NDEsImV4cCI6MTczNDc2MDc0MX0.u7s0puemiDCjbl3br6Vzzjy1jDUBCThm7WbJNuHtEKo"}});if(!e.ok)throw new Error(e.message||e?.statusText);const i=await e.json();console.log("Widget data submitted:",i),window.open(this.thankYouPageData?.isRedirect?this.thankYouPageData?.websiteUrl:"https://lead.mastersunion.org/student/application/doctoral-program/7d8f8d21-1ff3-4752-b414-6869ecbd046e?t=1","_blank"),t.innerHTML="Submit"}catch(e){console.log("Failed to submit widget data :",e),t.innerHTML="Submit"}})),this.iFrameDiv.classList="iFrameWidgetDiv",this.iFrameDiv.append(e,t),console.log("Widget iframe loaded")}}
